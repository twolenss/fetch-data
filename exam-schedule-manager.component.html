<!-- FORM SECTION -->
<form>
  <!-- TERM & START DATE IN ONE ROW -->
  <div style="display: flex; align-items: center; gap: 20px;">
    <!-- TERM & SCHOOL YEAR -->
    <div style="display: flex; align-items: center;">
      <label style="width: 150px; font-weight: 500; color: #0D47A1;">Term & School Year:</label>

      <mat-form-field appearance="outline" style="width: 250px;">
        <mat-label>Select Term & School Year</mat-label>
        <mat-select [(ngModel)]="activeTerm" name="activeTerm">
          <mat-option *ngFor="let item of combinedOptions" [value]="item.value">
            {{ item.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- FETCH BUTTON -->
    <div>
      <button mat-raised-button color="primary" (click)="selectTermYear()">Fetch</button>
    </div>
  </div>
</form>

<div class="p-4">
  <h2 class="mb-3">Exam Schedule Table</h2>

  <!-- Table Section -->
  <div *ngIf="programs.length > 0; else noData" style="overflow-x:auto;">
    <table border="1" cellspacing="0" cellpadding="8"
           style="width:100%; border-collapse: collapse; text-align: left;">
      <thead style="background-color: #1565C0; color: white;">
        <tr>
          <th>Program (Year)</th>
          <th *ngFor="let slot of timeSlots">{{ slot }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let prog of programs">
          <td>
            <b>{{ prog.program }}</b> - Year {{ prog.year }}
            <br>
            <small 
              [style.color]="prog.remainingSubjects === 0 ? 'red' : 'green'">
              Remaining: {{ prog.remainingSubjects }}
            </small>
          </td>

          <!-- Subject Select Boxes -->
          <td *ngFor="let slot of timeSlots">
            <select [(ngModel)]="prog.schedule[slot]"
                    (change)="onSubjectSelect(prog, slot)"
                    style="width: 150px; padding: 5px;">
              <option value="">-- Select --</option>
              <option *ngFor="let subj of prog.subjects"
                      [value]="subj.subjectId"
                      [disabled]="usedSubjectIds.has(subj.subjectId)">
                {{ subj.subjectId }} - {{ subj.subjectTitle }}
              </option>
            </select>
          </td>
        </tr>
      </tbody>
    </table>

    <div style="text-align:center; margin-top: 20px;">
      <button (click)="saveSchedule()"
              style="padding: 10px 20px; background-color:#1565C0; color:white; border:none; border-radius:5px;">
        Save Schedule
      </button>
    </div>
  </div>

  <ng-template #noData>
    <p class="text-center">No programs to display.</p>
  </ng-template>
</div>
